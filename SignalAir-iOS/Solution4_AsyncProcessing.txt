ğŸ”„ æ–¹æ¡ˆ4: ç•°æ­¥è™•ç†å„ªåŒ–

å•é¡Œ: ä¿¡ä»»è©•åˆ†è¨ˆç®—é˜»å¡ä¸»ç·šç¨‹
è§£æ±º: ç•°æ­¥ + æ‰¹æ¬¡ + å¢é‡è™•ç†

1. ç•°æ­¥ä¿¡ä»»è©•åˆ†
```swift
class AsyncTrustManager {
    private let trustQueue = DispatchQueue(label: "trust.calculation", 
                                         qos: .utility, 
                                         attributes: .concurrent)
    private let updateQueue = DispatchQueue(label: "trust.update")
    
    func updateTrustScore(for deviceId: String, activity: Activity) {
        trustQueue.async {
            let newScore = self.calculateTrustScore(deviceId, activity)
            
            self.updateQueue.async {
                self.trustScores[deviceId] = newScore
                self.notifyTrustUpdate(deviceId, newScore)
            }
        }
    }
}
```

2. æ‰¹æ¬¡è™•ç†æ©Ÿåˆ¶
```swift
class BatchTrustProcessor {
    private var pendingUpdates: [String: [Activity]] = [:]
    private let batchSize = 100
    private let batchInterval: TimeInterval = 5.0
    
    func addActivity(_ activity: Activity, for deviceId: String) {
        pendingUpdates[deviceId, default: []].append(activity)
        
        if pendingUpdates.values.flatMap({$0}).count >= batchSize {
            processBatch()
        }
    }
    
    private func processBatch() {
        let batch = pendingUpdates
        pendingUpdates.removeAll()
        
        // æ‰¹æ¬¡è™•ç†æ‰€æœ‰ç´¯ç©çš„æ´»å‹•
        for (deviceId, activities) in batch {
            let aggregatedActivity = aggregateActivities(activities)
            updateTrustScore(for: deviceId, activity: aggregatedActivity)
        }
    }
}
```

3. å¢é‡æ›´æ–°ç­–ç•¥
åªæ›´æ–°çœŸæ­£éœ€è¦æ›´æ–°çš„éƒ¨åˆ†:
```swift
struct IncrementalTrustUpdate {
    let deviceId: String
    let deltaScore: Double // åªè¨˜éŒ„è®ŠåŒ–é‡
    let timestamp: Date
    
    func apply(to currentScore: Double) -> Double {
        let decayFactor = calculateDecayFactor(since: timestamp)
        return max(0, min(100, currentScore + deltaScore * decayFactor))
    }
}
```

4. å„ªå…ˆç´šè™•ç†
```swift
enum TrustUpdatePriority {
    case emergency  // æƒ¡æ„è¡Œç‚ºç«‹å³è™•ç†
    case high      // é‡è¦æ´»å‹•5ç§’å…§è™•ç†  
    case normal    // ä¸€èˆ¬æ´»å‹•æ‰¹æ¬¡è™•ç†
    case low       // èƒŒæ™¯æ´»å‹•å»¶é²è™•ç†
}

class PriorityTrustProcessor {
    private var emergencyQueue: Queue<TrustUpdate> = Queue()
    private var highQueue: Queue<TrustUpdate> = Queue()
    private var normalQueue: Queue<TrustUpdate> = Queue()
    private var lowQueue: Queue<TrustUpdate> = Queue()
    
    func processUpdates() {
        // ä¾å„ªå…ˆç´šé †åºè™•ç†
        while !emergencyQueue.isEmpty {
            processUpdate(emergencyQueue.dequeue()!)
        }
        
        processHighPriorityBatch()
        processNormalPriorityBatch()
        processLowPriorityBatch()
    }
}
```

é æœŸæ•ˆæœ:
- ä¿¡ä»»è©•åˆ†è¨ˆç®—ä¸é˜»å¡UI
- è™•ç†é€Ÿåº¦æå‡10-50å€
- ç³»çµ±éŸ¿æ‡‰æ€§å¤§å¹…æ”¹å–„
- CPUä½¿ç”¨æ›´å‡å‹»