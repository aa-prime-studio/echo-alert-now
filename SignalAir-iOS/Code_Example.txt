ğŸ’» æœ€å®‰å…¨çš„å¯¦ä½œä»£ç¢¼

ç¬¬ä¸€æ­¥: æœ€å°æ”¹å‹•çš„ç•°æ­¥åŒ–

```swift
// åœ¨ç¾æœ‰çš„ TrustScoreManager.swift ä¸­æ·»åŠ 
extension TrustScoreManager {
    
    // æ–°å¢ç•°æ­¥ç‰ˆæœ¬ï¼Œä¿ç•™åŸæœ‰åŒæ­¥æ–¹æ³•
    func updateTrustScoreAsync(for deviceUUID: String, 
                              messageType: TrustMessageType = .general) {
        
        // åœ¨èƒŒæ™¯ç·šç¨‹è¨ˆç®—
        DispatchQueue.global(qos: .utility).async { [weak self] in
            guard let self = self else { return }
            
            // ä½¿ç”¨åŸæœ‰çš„è¨ˆç®—é‚è¼¯
            let newScore = self.calculateNewScore(for: deviceUUID, 
                                                type: messageType)
            
            // å›åˆ°ä¸»ç·šç¨‹æ›´æ–°
            DispatchQueue.main.async {
                self.trustScores[deviceUUID] = newScore
                self.saveScoresToStorage()
                
                // é€šçŸ¥UIæ›´æ–°
                NotificationCenter.default.post(
                    name: .trustScoreUpdated,
                    object: deviceUUID
                )
            }
        }
    }
    
    // åŸæœ‰æ–¹æ³•ä¿æŒä¸è®Šï¼Œæ·»åŠ é–‹é—œ
    func recordSuccessfulCommunication(for deviceUUID: String, 
                                      messageType: TrustMessageType = .general) {
        
        if UserDefaults.standard.bool(forKey: "useAsyncTrustUpdate") {
            updateTrustScoreAsync(for: deviceUUID, messageType: messageType)
        } else {
            // åŸæœ‰çš„åŒæ­¥è™•ç†é‚è¼¯ä¿æŒä¸è®Š
            updateTrustScoreSync(for: deviceUUID, messageType: messageType)
        }
    }
}
```

å„ªé»:
- åŸæœ‰ä»£ç¢¼99%ä¸è®Š
- å¯ä»¥éš¨æ™‚é–‹é—œ
- å‡ºå•é¡Œç«‹å³å›æ»¾
- æ¼¸é€²å¼æ¸¬è©¦